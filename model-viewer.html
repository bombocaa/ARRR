<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>model-viewer AR (Quick Look, Scene Viewer, WebXR)</title>
    <meta name="description" content="A minimal model-viewer example supporting iOS Quick Look, Android Scene Viewer, and WebXR." />
    <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/swiper@11/swiper-bundle.min.css" />
    <script src="https://unpkg.com/swiper@11/swiper-bundle.min.js"></script>
    <style>
      html, body { height: 100%; margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; background: #0b1020; color: #e5e7eb; }
      .header { display: none; }
      model-viewer { width: 100%; height: 100%; --poster-color: #0b1020; }
      .caption { position: fixed; bottom: 12px; left: 12px; right: 12px; color: #cbd5e1; font-size: .95rem; text-shadow: 0 1px 2px #0008; }
      .caption code { background: #0006; padding: 1px 6px; border-radius: 6px; }
      .credit { position: fixed; bottom: 12px; right: 12px; font-size: 0.85rem; color: #9ca3af; }
      .title-top { position: fixed; top: 12px; left: 50%; transform: translateX(-50%); margin: 0; padding: 6px 12px; font-size: 1.4rem; font-weight: 800; color: #ffffff; text-shadow: 0 2px 12px #000a; pointer-events: none; z-index: 10; }
      .nav-btn { position: fixed; top: 50%; transform: translateY(-50%); display: inline-flex; align-items: center; justify-content: center; width: 44px; height: 44px; border-radius: 50%; border: 1px solid #2a3656; background: #0f1736; color: #e5e7eb; cursor: pointer; box-shadow: 0 6px 20px #0006; }
      .nav-btn:hover { border-color: #4c9aff; }
      #navLeft { left: 12px; }
      #navRight { right: 12px; }
      .ql-button { position: fixed; left: 50%; transform: translateX(-50%); bottom: 16px; display: inline-flex; align-items: center; gap: 8px; padding: 10px 16px; border-radius: 999px; border: 1px solid #2a3656; background: #0f1736; color: #e5e7eb; font-weight: 800; cursor: pointer; box-shadow: 0 6px 20px #0006; }
      .ql-button:hover { border-color: #4c9aff; }
      .ql-icon { width: 20px; height: 20px; }
      .swiper { position: fixed; top: 52px; left: 50%; transform: translateX(-50%); width: 220px; height: 40px; z-index: 10; }
      .swiper-slide { display: flex; align-items: center; justify-content: center; color: #cbd5e1; background: #0f1736; border: 1px solid #2a3656; border-radius: 10px; }
      .swiper-pagination-bullets .swiper-pagination-bullet { background: #4c9aff; }
    </style>
  </head>
  <body>
    <div class="header"></div>

    <!--
      Notes:
      - src: GLB/GLTF for web preview
      - ios-src: USDZ for iOS Quick Look
      - ar-modes: 'quick-look scene-viewer webxr'
      - ar: shows the AR button
    -->
    <model-viewer
      id="viewer"
      src="assets/room.glb"
      ios-src="assets/roomm.usdz"
      alt="Room model"
      ar
      ar-modes="quick-look"
      ar-placement="floor"
      ar-scale="auto"
      camera-controls
      disable-zoom
      camera-target="auto"
      camera-orbit="0deg 65deg 130%"
      min-camera-orbit="auto auto 130%"
      max-camera-orbit="auto auto 130%"
      exposure="0.9"
      shadow-intensity="0.8"
      environment-image="legacy"
    >
      <div id="ar-prompt" slot="ar-prompt" style="display:none"></div>
    </model-viewer>

    <button id="quickLookBtn" class="ql-button" type="button" aria-label="Open in Quick Look">
      <svg class="ql-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M12 2l9 5v10l-9 5-9-5V7l9-5z" stroke="#9ab4ff" stroke-width="1.5"/>
        <path d="M12 7l5 3v4l-5 3-5-3V10l5-3z" stroke="#9ab4ff" stroke-width="1.5"/>
      </svg>
      Quick Look
    </button>
    <a id="qlLink" rel="ar" href="assets/roomm.usdz" style="display:none"></a>

    <h1 class="title-top" id="title">Room</h1>
    <div class="swiper" id="modelSwiper">
      <div class="swiper-wrapper">
        <div class="swiper-slide">Room 1</div>
        <div class="swiper-slide">Room 2</div>
      </div>
      <div class="swiper-pagination"></div>
    </div>
    <button id="navLeft" class="nav-btn" type="button" aria-label="Previous">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M15 6l-6 6 6 6" stroke="#9ab4ff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </button>
    <button id="navRight" class="nav-btn" type="button" aria-label="Next">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M9 6l6 6-6 6" stroke="#9ab4ff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </button>

    <script type="module">
      const models = [
        { glb: 'assets/room.glb', usdz: 'assets/room1.1.usdc' },
        { glb: 'assets/room2.glb', usdz: 'assets/room2.1.usdc' },
      ];
      const viewer = document.getElementById('viewer');
      const titleEl = document.getElementById('title');
      const qlLink = document.getElementById('qlLink');
      const swiper = new Swiper('#modelSwiper', {
        allowTouchMove: false,
        slidesPerView: 1,
        spaceBetween: 10,
        pagination: { el: '.swiper-pagination', clickable: true },
      });
      let currentIndex = 0;
      const applyModel = (index) => {
        const m = models[index];
        if (!m) return;
        viewer.src = m.glb;
        if (m.usdz) viewer.setAttribute('ios-src', m.usdz); else viewer.removeAttribute('ios-src');
        titleEl.textContent = `Room ${index + 1}`;
        if (m.usdz) qlLink.setAttribute('href', m.usdz);
      };
      document.getElementById('navLeft').addEventListener('click', () => { swiper.slidePrev(); });
      document.getElementById('navRight').addEventListener('click', () => { swiper.slideNext(); });
      swiper.on('slideChange', () => {
        currentIndex = swiper.realIndex;
        applyModel(currentIndex);
      });
      applyModel(currentIndex);

      // Quick Look button: ask confirmation then activate AR (iOS Quick Look)
      const quickBtn = document.getElementById('quickLookBtn');
      quickBtn.addEventListener('click', () => {
        const proceed = confirm('Open this 3D model?');
        if (!proceed) return;
        try {
          viewer.activateAR();
        } catch (e) {
          // Fallback: direct Quick Look link
          if (qlLink && qlLink.href) {
            qlLink.click();
          } else {
            alert('Could not open in Quick Look. Ensure the USDZ is accessible over HTTPS with Content-Type model/vnd.usdz+zip.');
          }
        }
      });
    </script>
  </body>
  </html>


